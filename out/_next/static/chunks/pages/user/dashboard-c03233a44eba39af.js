(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[894],{3267:function(e,t,n){"use strict";var r=n(7294),s=n(653),a=n(381),o=n.n(a),c=n(3863),i=n(4447),l=n(6513),u=n(1255),d=n(6548),p=n(8689),m=n(143),h=n(1163),f=n(4710),x=n(1664),v=n.n(x),j=n(5893);t.Z=function(e){var t=e.commentsCount,n=e.removeComment,a=e.handleDelete,x=e.handleLikes,g=e.handleComment,b=e.p,w=(0,r.useContext)(m.S)[0],y=(0,h.useRouter)();return(0,j.jsx)(j.Fragment,{children:b&&(0,j.jsx)("div",{className:"card",children:(0,j.jsx)("div",{children:(0,j.jsxs)("div",{className:"card-body",children:[(0,j.jsxs)("div",{className:"card-header",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)(c.C,{src:(0,f.d)(b),size:"large",alt:b.user&&b.user.name,children:"one love"})," "]}),(0,j.jsxs)("span",{className:"pt-2 ml-3",children:["Posted by ",b.user&&b.user.name]}),(0,j.jsx)("span",{children:" "}),(0,j.jsx)("span",{className:"pt-2 ml-3",children:o()(b.createdAt).fromNow()})]}),(0,j.jsx)("div",{className:"card-body",children:(0,s.ZP)(b.content)}),(0,j.jsxs)("div",{className:"card-footer",children:[(0,j.jsx)("div",{style:{backgroundImage:"url(".concat(b.image&&b.image.url,")"),backgroundSize:"cover",backgroundPosition:"center center",backgroundRepeat:"no-repeat",height:"300px"}}),(0,j.jsxs)("div",{className:"d-flex pt-2",children:[w&&w.user&&b.likes.includes(w.user._id)?(0,j.jsxs)("span",{className:"text-primary pt-2 h5 px-2",children:[(0,j.jsx)(i.Z,{onClick:function(e){return x(b)}}),b.likes.length," likes"]}):(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)("span",{className:"text-primary pt-2 h5 px-2",children:[(0,j.jsx)(l.Z,{onClick:function(e){return x(b)}}),b.likes.length," likes"]})}),(0,j.jsx)(u.Z,{onClick:function(){return g(b)},className:"text-primary pt-2 h5 px-2"})," ",(0,j.jsx)("div",{className:"pt-2 pl-3",children:(0,j.jsx)(v(),{href:"/post/".concat(b._id),passHref:!0,legacyBehavior:!0,children:(0,j.jsxs)("a",{className:"text-decoration-none",children:[b.comments&&b.comments.length," comments"," "]})})}),(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(d.Z,{onClick:function(){return y.push("/user/post/".concat(b._id))},className:"text-danger pt-2 h5 px-2 mx-auto"}),(0,j.jsx)(p.Z,{onClick:function(){return a(b)},className:"text-danger pt-2 h5 px-2"})]})]})]}),b.comments&&b.comments.length>0&&(0,j.jsx)("ol",{className:"list-group",style:{maxHeight:"125px",overflowY:"scroll"},children:b.comments.slice(0,void 0===t?4:t).map(function(e){return(0,j.jsxs)("li",{className:"list-group-item d-flex list-group-item-action justify-content-between align-items-start",children:[(0,j.jsxs)("div",{className:"ms-2 me-auto",children:[(0,j.jsx)("div",{className:"ms-2 me-auto",children:(0,j.jsx)(c.C,{src:(0,f.d)(b),size:20,className:"mb-1 mr-3",alt:b.user&&b.user.name})}),b.user&&b.user.name,(0,j.jsx)("div",{className:"ms-2 me-auto",children:e.text})]}),(0,j.jsxs)("span",{className:"badge badge-primary rounded-pill text-muted",children:[o()(e.created).fromNow(),w&&w.user&&w.user._id===e.user||e.user._id&&(0,j.jsx)("div",{className:"ml-auto mt-1",children:(0,j.jsx)(p.Z,{onClick:function(){return n(b._id,e)},className:"text-danger pt-2 h5 px-2"})})]})]},e._id)})})]},b._id)})})})}},527:function(e,t,n){"use strict";var r=n(5893);t.Z=function(e){var t=e.addComment,n=e.comment,s=e.setComment;return(0,r.jsxs)("form",{onSubmit:t,children:[(0,r.jsx)("input",{type:"text",className:"form-control",placeholder:"Add a comment",value:n,onChange:function(e){return s(e.target.value)}}),(0,r.jsx)("button",{type:"submit",className:"btn btn-primary btn-block mt-2",children:"Add Comment"})]})}},1933:function(e,t,n){"use strict";var r=n(3863),s=n(5152),a=n.n(s),o=n(888),c=n(8916);n(7676);var i=n(5893),l=a()(function(){return Promise.all([n.e(937),n.e(167)]).then(n.t.bind(n,1167,23))},{ssr:!1,loadableGenerated:{webpack:function(){return[1167]}}});t.Z=function(e){var t=e.content,n=e.handleQuillChange,s=e.postSubmit,a=e.handleImageUpload,u=e.uploading,d=e.image;return(0,i.jsxs)("div",{className:"card",children:[(0,i.jsx)("div",{className:"card-body pb-3",children:(0,i.jsx)("form",{action:"",className:"form-group",children:(0,i.jsx)(l,{theme:"snow",value:t,onChange:n,className:"form-control",placeholder:"Write something..."})})}),(0,i.jsxs)("div",{className:"card-footer d-flex justify-content-between text-muted",children:[(0,i.jsx)("button",{disabled:!t,className:"btn btn-primary",onClick:s,children:"Post"}),(0,i.jsxs)("label",{className:"form-label",children:[d&&d.url?(0,i.jsx)(r.C,{size:30,src:d.url}):u?(0,i.jsx)(o.Z,{className:"text-primary me-2 mb-1",style:{display:u?"inline-block":"none"}}):(0,i.jsx)(r.C,{size:30,icon:(0,i.jsx)(c.Z,{})}),(0,i.jsx)("input",{onChange:a,type:"file",accept:"image/*",hidden:!0})]})]})]})}},5540:function(e,t,n){"use strict";var r=n(29),s=n(4687),a=n.n(s),o=n(7294),c=n(1163),i=n(5121),l=n(8165),u=n(143),d=n(5893);t.Z=function(e){var t=e.children,n=(0,o.useState)(!1),s=n[0],p=n[1],m=(0,o.useContext)(u.S)[0],h=(0,c.useRouter)();function f(){return x.apply(this,arguments)}function x(){return(x=(0,r.Z)(a().mark(function e(){var t;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.Z.get("/current-user");case 3:console.log("data wooo =>",t=e.sent.data),t.success&&p(!0),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0),p(!1),h.push("/login");case 14:case"end":return e.stop()}},e,null,[[0,9]])}))).apply(this,arguments)}return(0,o.useEffect)(function(){m&&m.token&&f()},[m,m.token]),null===m&&setTimeout(function(){return f()},1e3),s?(0,d.jsx)(d.Fragment,{children:t}):(0,d.jsx)(l.Z,{spin:!0,className:"d-flex justify-content-center display-1 text-primary p-5"})}},4710:function(e,t,n){"use strict";n.d(t,{d:function(){return r}});var r=function(e){return"string"==typeof e.photo?e.photo:e.photo&&"data"in e.photo?e.photo.data:e.image&&"url"in e.image?e.image.url:"https://zos.alipayobjects.com/rmsportal/ODTLcjxAfvqbxHnVXCYX.png"}},8777:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return E}});var r=n(8307),s=n(29),a=n(4687),o=n.n(a),c=n(7294),i=n(1163),l=n(143),u=n(5540),d=n(1933),p=n(5121),m=n(2920),h=n(3267),f=n(5893),x=function(e){var t=e.posts,n=e.handleDelete,r=e.handleLikes,s=e.handleComment,a=e.removeComment;return(0,f.jsx)("div",{className:"card",children:(0,f.jsx)("div",{children:t&&t.map(function(e){return(0,f.jsx)(h.Z,{p:e,handleDelete:n,handleLikes:r,handleComment:s,removeComment:function(e,t){return a(e,t)}},e._id)})})})},v=n(381),j=n.n(v),g=n(9930),b=n(3863),w=n(4710),y=function(e){var t=e.people,n=e.handleFollow,r=e.handleUnfollow,s=(0,c.useState)(!1),a=s[0];s[1];var o=(0,c.useContext)(l.S)[0],d=(0,i.useRouter)();return(0,f.jsx)(u.Z,{children:(0,f.jsx)("div",{children:(0,f.jsx)(g.Z,{loading:a,itemLayout:"horizontal",dataSource:t,renderItem:function(e){return(0,f.jsx)(g.Z.Item,{children:(0,f.jsx)(g.Z.Item.Meta,{avatar:(0,f.jsx)(b.C,{src:(0,w.d)(e)}),title:(0,f.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,f.jsx)("a",{onClick:function(){return d.push("/user/profile/".concat(e._id))},children:e.name}),o&&o.user&&e.followers&&e.followers.includes(o.user._id)?(0,f.jsx)("span",{className:"text-primary pointer",onClick:function(){return r(e)},children:"unfollow"}):(0,f.jsx)("span",{className:"text-primary pointer",onClick:function(){return n(e)},children:"follow"})]}),description:j()(e.createdAt).fromNow()})},e._id)}})})})},k=n(527),N=n(1664),Z=n.n(N),C=n(1298),_=n(4513);function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var P=function(){var e,t,n,r=(0,c.useContext)(l.S),a=r[0],i=r[1],u=(0,c.useState)(""),d=u[0],h=u[1],x=(0,c.useState)([]),v=x[0],j=x[1];(0,c.useEffect)(function(){a.token&&""!==d.trim()&&g()},[d,a.token]);var g=(e=(0,s.Z)(o().mark(function e(){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.Z.get("/user/search",{params:{query:d},headers:{Authorization:"Bearer ".concat(a.token)}});case 3:j(e.sent.data.users),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(){return e.apply(this,arguments)}),b=(t=(0,s.Z)(o().mark(function e(t){var n;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.Z.put("/follow-user",{_id:t._id},{headers:{Authorization:"Bearer ".concat(a.token)}});case 3:n=e.sent.data,i(function(e){return S(S({},e),{},{people:n.people})}),j(v.filter(function(e){return e._id!==t._id})),m.Am.success(n.message,{theme:"colored"}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0);case 14:case"end":return e.stop()}},e,null,[[0,11]])})),function(e){return t.apply(this,arguments)}),w=(n=(0,s.Z)(o().mark(function e(t){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.Z.put("/unfollow-user",{personId:t._id},{headers:{Authorization:"Bearer ".concat(a.token)}});case 3:i(function(e){return S(S({},e),{},{people:e.people.filter(function(e){return e._id!==t._id})})}),j(v.filter(function(e){return e._id!==t._id})),m.Am.error("Unfollowed ".concat(t.name),{theme:"colored"}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0);case 12:case"end":return e.stop()}},e,null,[[0,9]])})),function(e){return n.apply(this,arguments)});return(0,f.jsxs)("div",{children:[(0,f.jsxs)("form",{onSubmit:function(e){e.preventDefault(),g()},className:"form-inline row",children:[(0,f.jsx)("input",{onChange:function(e){return h(e.target.value)},placeholder:"Search",className:"form-control",value:d,type:"search"}),(0,f.jsx)("button",{type:"submit",className:"btn btn-outline-primary col-12",children:"Search"})]}),v&&(0,f.jsx)(y,{handleUnfollow:w,handleFollow:b,people:v,followers:[]})]})};function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var z=(0,n(3920).ZP)("http://localhost:8000",{reconnection:!0}),E=function(){var e,t,n,r,a,h,v,j,g,b,w=(0,c.useContext)(l.S),N=w[0],O=w[1],S=(0,c.useState)(""),A=S[0],E=S[1],I=(0,c.useState)(!1),B=I[0],F=I[1],U=(0,c.useState)({}),L=U[0],R=U[1],H=(0,c.useState)([]),T=H[0],X=H[1],q=(0,c.useState)(!1),J=q[0],Q=q[1],W=(0,c.useState)(""),Y=W[0],G=W[1],M=(0,c.useState)(!1),V=M[0],K=M[1],$=(0,c.useState)(null),ee=$[0],et=$[1],en=(0,i.useRouter)();N.user;var er=N.people,es=(0,c.useState)(0),ea=es[0],eo=es[1],ec=(0,c.useState)(1),ei=ec[0],el=ec[1];(0,c.useEffect)(function(){N&&N.token&&(ed(),eu())},[N&&N.token,ei]),(0,c.useEffect)(function(){try{p.Z.get("/total-posts").then(function(e){var t=e.data;eo(t.total)})}catch(e){console.log(e)}});var eu=(e=(0,s.Z)(o().mark(function e(){var t;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.Z.get("/find-people",{headers:{Authorization:"Bearer ".concat(N.token)}});case 3:t=e.sent.data,O(D(D({},N),{},{people:t.people})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(){return e.apply(this,arguments)}),ed=(t=(0,s.Z)(o().mark(function e(){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.Z.get("/news-feed/".concat(ei));case 3:X(e.sent.data.posts),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(){return t.apply(this,arguments)}),ep=(n=(0,s.Z)(o().mark(function e(){var t;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.Z.post("/create-post",{content:A,image:L},{headers:{Authorization:"Bearer ".concat(N.token)}});case 3:(t=e.sent.data).success?(ed(),E(""),R({}),m.Am.success(t.message,{theme:"colored"}),t.success&&z.emit("new-post",t.postWithUser)):m.Am.error(t.message,{theme:"colored"}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(){return n.apply(this,arguments)}),em=(r=(0,s.Z)(o().mark(function e(t){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,window.confirm("Are you sure?")){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,p.Z.delete("/delete-post/".concat(t._id));case 6:e.sent.data,m.Am.error("Post deleted"),ed(),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0);case 15:case"end":return e.stop()}},e,null,[[0,12]])})),function(e){return r.apply(this,arguments)}),eh=(a=(0,s.Z)(o().mark(function e(t){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,J){e.next=12;break}return Q(!0),console.log("ger"),e.next=6,p.Z.put("/like-post/".concat(t._id));case 6:console.log("ge",e.sent.data),ed(),e.next=18;break;case 12:return Q(!1),e.next=15,p.Z.put("/dislike-post/".concat(t._id));case 15:e.sent.data,ed();case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),console.log(e.t0);case 23:case"end":return e.stop()}},e,null,[[0,20]])})),function(e){return a.apply(this,arguments)}),ef=(h=(0,s.Z)(o().mark(function e(t){var n,r,s;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=t.target.files[0],(r=new FormData).append("image",n),F(!0),e.prev=5,e.next=8,p.Z.post("/upload-image",r);case 8:s=e.sent.data,F(!1),R({url:s.result.secure_url,public_id:s.result.public_id}),s.success?m.Am.success(s.message,{theme:"colored"}):m.Am.error(s.message,{theme:"colored"}),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(5),console.log(e.t0),F(!1);case 19:case"end":return e.stop()}},e,null,[[5,15]])})),function(e){return h.apply(this,arguments)});if(null===N)return en.push("/login"),null;var ex=(v=(0,s.Z)(o().mark(function e(t){var n,r,s;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.Z.put("/follow-user",{_id:t._id},{headers:{Authorization:"Bearer ".concat(N.token)}});case 3:n=e.sent.data,(r=JSON.parse(localStorage.getItem("auth"))).user=n.user,localStorage.setItem("auth",JSON.stringify(r)),O(D(D({},N),{},{user:n.user})),s=er.filter(function(e){return e._id!==t._id}),O(D(D({},N),{},{people:s})),eu(),ed(),m.Am.success(n.message,{theme:"colored"}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.log(e.t0);case 19:case"end":return e.stop()}},e,null,[[0,16]])})),function(e){return v.apply(this,arguments)}),ev=(j=(0,s.Z)(o().mark(function e(t){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:et(t),K(!0);case 2:case"end":return e.stop()}},e)})),function(e){return j.apply(this,arguments)}),ej=(g=(0,s.Z)(o().mark(function e(t){var n;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,p.Z.post("/create-comment",{content:Y,postId:ee._id},{headers:{Authorization:"Bearer ".concat(N.token)}});case 4:n=e.sent.data,G(""),K(!1),ed(),m.Am.success(n.message,{theme:"colored"}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),console.log(e.t0);case 15:case"end":return e.stop()}},e,null,[[1,12]])})),function(e){return g.apply(this,arguments)}),eg=(b=(0,s.Z)(o().mark(function e(t,n){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(window.confirm("Are you sure you want to delete this comment?")){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,p.Z.delete("/user/post/".concat(t,"/comment/").concat(n._id));case 6:e.sent.data,ed(),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),console.error("Error deleting comment:",e.t0);case 14:case"end":return e.stop()}},e,null,[[3,11]])})),function(e,t){return b.apply(this,arguments)});return(0,f.jsx)(u.Z,{children:(0,f.jsxs)("div",{className:"container-fluid",children:[(0,f.jsx)("div",{className:"row py-5 text-light bg-default-image",children:(0,f.jsxs)("div",{className:"col text-center",children:[(0,f.jsx)("h1",{className:"display-4",children:"News feed"}),(0,f.jsxs)("h2",{className:"",children:["Hello ",N.user&&N.user.name]})]})}),(0,f.jsxs)("div",{className:"row py-3",children:[(0,f.jsxs)("div",{className:"col-md-8",children:[(0,f.jsx)(d.Z,{content:A,handleQuillChange:function(e){e.replace(/<\/?p>/gi,""),E(e)},postSubmit:ep,handleImageUpload:ef,uploading:B,image:L}),(0,f.jsx)("br",{}),(0,f.jsx)(x,{posts:T,like:J,handleDelete:em,handleLikes:eh,handleComment:ev,removeComment:eg}),(0,f.jsx)(C.Z,{current:ei,total:ea/3*10,onChange:function(e){return el(e)}})]}),(0,f.jsxs)("div",{className:"col-md-4",children:[(0,f.jsx)(P,{}),(0,f.jsx)("h3",{className:"text-center",children:"People you may know"}),N&&N.user&&(0,f.jsx)(Z(),{href:"/user/following",legacyBehavior:!0,children:(0,f.jsxs)("a",{className:"h6",children:[N.user.following.length," Following"]})}),(0,f.jsx)(y,{people:N.people,handleFollow:ex,handleUnfollow:function(){},followers:N.user&&N.user.followers})]})]}),(0,f.jsx)(_.Z,{visible:V,onCancel:function(){return K(!1)},title:"Comment",footer:null,children:(0,f.jsx)(k.Z,{addComment:ej,comment:Y,setComment:G})})]})})}},9708:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/user/dashboard",function(){return n(8777)}])},247:function(){}},function(e){e.O(0,[885,438,513,683,777,920,594,506,774,888,179],function(){return e(e.s=9708)}),_N_E=e.O()}]);